---
show: step
version: 1.0
enable_checker: true
---

# 深入浮点型数字

## 回忆

- 上次了解分数类型变量
- 有三种初始化方法
  - 用小数当参数
  - 用整数当分子和分母
  - 用字符串
- 关于精度
  - 由于二进制无法精确对应十进制小数
  - 所以用分数
  - 或者用 Decimal 函数

## Decimal 函数

- Decimal 函数一定接收字符串型变量参数才能保持精确性
- 如果接收浮点型参数无法保持精确性

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210905-1630829490200)

- Fraction 和 Decimal 都可以保持精确性
- 例子里面有个 $-47e^{-2}$ 这是什么意思？🤪

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210905-1630829665648)

### e

- 使用 $-47e^{-2}$

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629505705330)

- 第一个符号表示当前数字的正负
- 第二个符号表示十的指数
- $-47e^{-2}$ = $-47 x 10^{-2}$

## 练习

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629506176527)

- 这种表示法是科学计数法
- 一般来说小数点前面有一个数字
- 后面有尾数
- 再乘以指数
- 但是最终还是用 2 进制的方式存储的
- 有了这个我们可以算点复杂的东西了

### 正五边形面积

- 假设正五边形的边长为 a
- area = $\frac{5*a^{2}}{4 * tan\frac{π}{5}}$
- 这就是面积公式

```
import math
a = eval(input("请输入边长:"))
area = 5*a*a/(4*math.tan(math.pi/5)
```

- 这里面就涉及到了 math 这个 module 包
- 这里面有各种数学函数包
- 还有什么函数呢？

### help(math)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211212-1639264326715)

- 通过 import 可以把这个包引入进来

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211212-1639264338411)

- 以上就是我们可以看到的函数
- 看名字你知道他们含义么？
- 这些都是可以用在浮点型运算里面的函数
- 但是浮点型数字究竟是如何存储的呢？

### 存储

- $0.5$

  = $2^{-1}$

- $0.625$

  = $2^{-1} + 2^{-3}$

  = $1 × 2^{-1} + 0 x 2^{-2} + 1 × 2^{-3}$

  =$(0.101)_{2 进制}$

- $0.1$

  = $2^{-4} + 2^{-5} + 2^{-8} + 2^{-9}$...

  = $0 × 2^{-1} + 0 × 2^{-2} + 0 × 2^{-3} + 1 × 2^{-4} + 1 × 2^{-5}$ ...

  $(0.000110011...)_{2 进制}$

- $0.1$ 是无法找到绝对对应的二进制数

## 实际情况

- 最终还是落实到浮点数形式进行存储

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629506297983)

- 三部分
  - 正负号
  - 指数
  - 尾数
- p 之前是有效数字
- p 之后是指数

#### 显示边缘

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629506397246)

- 如果是 $10$ 的 $-347$ 次方
- 就看不到了
- 无法记录
- 变成了 0
- 具体最小多小能存的下呢？
- 这个规则叫做 $ieee-754$
- 是从 c 语言的时候就定下来的 [浮点型规则](http://www.binaryconvert.com/result_double.html)

## 绝对值最小浮点数

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629506657270)

- 指数部分最小
- 当指数部分为 0 时
  - 尾数开头的 1 取消
  - 尾数如果全零就是零
  - 尾数部分最小只有最后 1 位
- 63 个 $0$，1 个 $1$
- `00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001`
- 验证一下

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629507079178)

- 最大的浮点数是多少呢？

### 最大数

- 尝试指数全 1

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629506991064)

- 指数全 1 的结果是 NaN
- Not a Number
- 不是一个数字
- 看来指数不能全 1
- 继续尝试

### 最大值

- 从指数全 1 减去 1
- 得到下图的指数状态
- 有效数字部分都是 1

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629507034718)

- $1.79769313486231570814527423732 * 10^{308}$
- 验证一下

### 验证

- 这个数值是可以得到的

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629507409225)

- 但为什么加 1 没有效果
- 因为是浮点运算
- 所以需要移位才能相加
- 在 $10$ 的 $308$ 次方面前
- 1 一移位就变成了 0 了
- 但是如果能够把尾数最后 1 位加 1
- 就直接进上去了
- 结果是 inf 正无限
- infinite
- 就是我们所说的正无穷
- 如果我还想往上加可能么?

## 整型

- 用浮点型是不行了
- 改成整型

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629507965781)

- 一行 80 个字符
- 3 行多大概 308 个字符
- 不但可以乘以 10
- 居然可以来个最大值的乘方
- python 肯定对 int 整型做了些什么
- 这就要查看 python 的源代码了
- 我们回到浮点型

### inf 和 nan

- inf
  - infinity
  - 正无穷
- nan
  - not a number
  - 不是数

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210917-1631881851893)

- 最大值 $1e308$ 再乘以 $10$
  - 得到了 float("inf")
  - 也是一个 float 型的值
- 正无穷乘以 0
  - 可以得到 float("nan")
  - 因为他乘出来不好说具体是多少所以得到了 float("nan")
  - Not a Number
  - 不是数

## 总结

- 这次了解科学计数法
- 科学计数法分成有效数字和指数两块
- 找到了双精度 double 型中绝对值最小和最大的数
- 最后发现 int 型在大数方面有效数字超过了双精度？
- 这可能吗？🤪
- 下次再说 👋

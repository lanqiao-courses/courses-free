---
show: step
version: 1.0
enable_checker: true
---

# 分数类型

## 回忆

- 这次了解浮点类型变量
- 有两种表示法
  - float 4 字节 单精度浮点型
  - double 8 字节 双精度浮点型
- 浮点型特点
  - 第一位都是符号位
  - 小数点都浮动
  - 浮动程度由指数部分决定
  - 尾数部分默认 1 开头
  - 后面的小数部分是有效数字
- 这就是浮点类型的数据
- 这个问题简直致命！
- 太容易出错
- 尤其是和钱相关的

## 算钱用浮点

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210905-1630830571153)

- 有没有减少出错的方法？🤪

#### 分数类型

- 首先引入一个 module 模块
- 模块的名字叫做 fraction

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469167836)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469259935)

- 大意就是把一个东西分成几份
- 源文件在
  - `/usr/lib/python3.8/fractions.py`

#### 构造方法

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469179740)

- 调用的时候需要引用模块名
- 直接给一个浮点数的话
- 效果并不好

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469350052)

#### 分子分母

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469860876)

- 使用分子分母的构造方法试试

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469949278)

- 效果不错
- 至少 $\frac{3}{10}$ 用分数描述没有误差
- 甚至还会自动约分

#### 数字分类

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629498062292)

- 这类数字可以写成两个整数的比值
  - 也叫成比值的数
  - 包括有限小数和无限循环小数
  - rational number
  - 被翻译为有理数
- 不能写成两个整数比值的叫做
  - 不成比值的数
  - 主要指无限不循环小数
  - irrational number
  - 被翻译为无理数
- 有理数和无理数统称实数 Real

## 翻译过程

- 有理数在希腊文中称为 λογος
- 原意是"成比例的数"
- 毕达哥拉斯对于音高和弦长的比例很有研究
- 对于比例和音程和谐的关系的分析也很有道理
- 英文取其意
- 以 ratio 为字根
- 在字尾加上-nal 构成形容词
- 全名为 rational number
- 直译成汉语即是"可比数"

- 明末数学家徐光启和利玛窦翻译《几何原本原本》前 6 卷时的底本是拉丁文
- 他们将这个词（“λογος”）译为“理”
- 这个“理”指的是“比值”

- 日本在明治维新以前
- 欧美数学典籍的译本多半采用中国文言文的译本
- 日本学者将中国文言文中的“理”直接翻译成了理
- 而不是文言文所解释的“比值”
- 日本学者直接翻译出了“有理数”和“无理数”。

- 当有理数从日本传回中国时又延续这一说法
- 清末中国派留学生到东洋留学
- 将此名词传回中国
- 以至现在中日两国都用“有理数”和“无理数”的说法

#### 数学总结

- 正整数、零、负整数统称整数
- 有限小数或无限循环小数都是有理数
- 无限不循环小数是无理数
- 有理数和无理数统称实数 Real

## 分子分母

- 分子 numerator
- 分母 denominator

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629498539608)

#### 控制精度

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629499416027)

- Fraction.from_float(0.3) 和 Fraction(3,10) 并不相等
- $0.3$ 难道不是有理数么？
- $0.3$ 在用十进制表示的时候是一个有理数
- 但是在 2 进制表示的时候是无限循环的
  - 还记得 $0.1+0.1+0.1$ 么
- 落实到具体的 52 位尾数的时候
- 就成了一个 2 进制的 $0.3$
- 实际上是用二进制存储的一个数
- 然后再转回到分数形式
- Fraction(3,10) 直接就是分数形式
- 那可以简化分数么？

#### 控制分母

- `limit_denominator (i_max_denominator)`
- 可以把分母的大小控制在一定的范围内

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211030-1635566985771)

- limit_denominator 的作用主要是控制精度
- 精度上去之后，可能产生的分数结果不一样
- 不过有的时候，精度上去了，对于结果分数的影响不大
- 比如 $1000$ 和 $10000$ 这两档，其实分数结果相同
- 类似的还有

#### 调节精度

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629498863176)

- 前面几个结果
  - 看起来精度的变化
  - 并没有影响到最终运算的结果
  - 那是因为精度没有影响到最终分数的生成
- 一般来说
  - 精度对于最终的分数结果是有影响的

## 其他进制

- 负数
- 其他进制形式
- 小数
- 都可以直接做参数么？

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629500899689)

- 负数、其他进制形式都可以
- 但是小数好像不能直接作为分子和分母
- 小数可以作为唯一参数进入么？

#### 转化

- 小数可以转化为分数的形式

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210822-1629596271197)

- 分数自身可以做分子分母么？

#### 分数做分子分母

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629500976293)

- 分数可以做分子、分母

#### 分数运算

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210822-1629596136870)

- 分数类型支持加减乘除运算
- 结果还是分数类型

#### 字符串形式

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629470181247)

- 字符串形式会用 slash 把字符串切开
- 分成分子和分母
- 然后再进行分数的初始化
- 初始化就是 initialization
- 就像新买的电脑要进行用户名密码的初始化配置一样
- 变量初始化就是对变量进行初始化配置

#### 更多例子

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210820-1629469199685)

## decimal

- 例子里面有个转化为精确十进制数的方法
- decimal 模块中的 Decimal 函数

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210821-1629501307703)

- 源代码位置在
  - `/usr/lib/python3.8/decimal.py`

## 总结

- 这次了解分数类型变量
- 有三种初始化方法
  - 用小数当参数
  - 用整数当分子和分母
  - 用字符串
- 关于精度
  - 由于二进制无法精确对应十进制小数
  - 所以用分数
  - 或者用 Decimal 函数
- 例子里面有个-47e-2 这是什么意思？🤪
- 下次再说 👋

---
show: step
version: 1.0
enable_checker: true
---

# 换行回车

## 回忆上次内容

- 我们狂飙了一路
  - 用 shell 执行 python 程序
  - 用 shell 循环执行 python 程序
- 循环体中
  - 把 python 的输出结果用管道交给了 figlet 程序
  - 把 figlet 输出的结果用管道给了 cowsay
  - 把 cowsay 的结果给了 lolcat
- 最后是提权直接运行程序
- 我们回忆一下我们最开始时
- 回到本行最初的方法
  - print("\r"+localtime,end="")
  - `\r` 与 `\n` 不同
- 从含义上来看
  - `\n` - LF - LineFeed - 换行
  - `\r` - CR - CarriageReturn - 回车
- 换行和回车有什么不同吗？🤔

### 换行回车

- 说到这个换行回车呢，就不得不说起当时的终端形态
- 电传打字机`TTY` 全称 `T`ele`TY`pewriter
  - `tele`的意思是远程的
    - 电报 telegram
    - 望远镜 telescope
    - 电视机 television
  - `type`是打字
  - `writer`是`写字的人`
  - 合在一起就是`打字机`
  - 特指 `电传打字机`
- 早年间他以`电报`的方式存在
  - 后来股票电报机大规模应用
  - 大西洋下面铺设了海底光缆
  - 具体可以看 [《oeasy 教您玩转电磁波》第 5 话](https://www.bilibili.com/video/BV1vx411T7qy?p=6)
- 大量`tty`相连接，构成了当时传播信息的`tty`网络
  - 当时没有路由器，每个人都是消息的发送、接收、转发者
  - 早年间电脑不能和`tty`相连接
  - 直到 1959 年 DEC 公司生产的 `PDP－1` 电脑，用了纸带 TTY
  - 后来 tty 有了专门的纸张
- `tty`既是键盘，又是显示器(以打字机的形态存在的显示器)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613914040719)

### 后续变化

- 最早的计算机(如 eniac)不能和`tty`相连
- 后来可通过串口线和主机连接
- 很多终端远程登录的时候用的名称也是`tty`之类的东西

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210923-1632374467523)

- 但是通信线路变成了网线
  - ssh 基于`tcp/ip`协议
  - 可以自动路由转发
- `tty`、`terminal`、`shell`、`console` 好像都是终端
- 有什么不一样吗？

### 标准输入输出流

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211120-1637407268046)

- 桌面上的打字机同时是输入和输出
  - 键盘是标准输入 stdin
  - 打字机是标准输出 stdout
- 一个主机可以连接一个终端
- 终端从最开始的电传打字机发展成显示器和键盘

### 区分几个概念

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613916532296)

- `Console` 控制台
  - 可以理解为主机 MainFrame 的控制面板
  - 从底层监控操作系统
    - 有显示寄存器状态的指示灯
    - 有直接操作寄存器的开关
  - 而且它与电脑主机紧密结合
  - 无法远程操作
- `terminal`终端
  - 电脑连线结束的端点
  - 一般是一个`tty`之类的东西
  - 当时的大流行设备是`Teletype Model 33`
  - `Xterm`就是一个`X Window terminal`
  - `terminal`上面运行着`shell`
- 其实我们今天笔记本电脑的键盘和显示器也是一个终端

### 主机-终端时代

- 一台主机可以连接多个终端
- 终端和通过 shell 和 kernel 交互
- kernel 再去操作硬件

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20211120-1637407886132)

- 可以当年说终端的 shell 就是当年的浏览器
- 后来个人电脑普及人人都有自己的主机
- 然后主机终端模式通过服务器浏览器再一次复活
- 只不过这次的复活基于 tcp/ip 网络
- 主机更多分布更广网络更复杂

### shell

- `shell` 壳子
  - 终端硬件基础上的软件壳子
  - 可以有不同的壳子`ksh`、`csh`、`bash`等
  - 一套壳子就是一套命令解释系统
    - 比如把`ls`解释为当前文件夹文件列表
    - 可以管理前台和后台程序运行
    - 智能体通过壳子控制硬件
    - 通过硬件控制外部世界
  - 方便终端上的 tty 和电脑主机交互
  - SSH 为 `Secure Shell `

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210812-1628754254744)

- 运行 shell 的接收装置是 tty

### tty

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210923-1632374467523)

- `TTY TeleTYpewriter` 电传打印机
  - 位于终端的原始电脑连接硬件
  - 接收电脑发送过来的字节
  - 发送字节给电脑

### 回顾

- 想要知道`\r`是什么
- 先回忆`\n`是什么
  - 早年间要回车需要传过来一个`\n`这样的字符
  - 对应的字节为`0x0A`
  - 目标是新启一行
  - `\n`也可以存储

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210923-1632389971431)

- 编写一个纯文本
- 输入 ab12 中间加一个回车
- `:%!xxd`
- `:%!xxd -r`变回来

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210923-1632389996078)

- 可以看到那个回车换行的位置
- 是`0x0a`

### \r

- 那么`\r`这样的字符
- 对应字节是多少呢？
- 是干什么用的呢

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613917872385)

- 也就是说`\r`是`1`个`ascii`字符
- `\r` 对应的字符是 `0x0d`

### 电传打字机对换行和回车的理解

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210221-1613914040719)

- 作为电传打字机来说，
- 换行和回车是两回事
  - 换行 对应字节`0x0A`
    - `Line-Feed`
    - 意思是水平不动、垂直向上喂纸
    - 所以是`feed`
  - 回车 对应字节`0x0D`
    - `Carriage-Return`
    - 让上图可移动的打印头(好像可移动的四轮马车 Carriage)
    - 垂直不动、水平 `回`到纸张左侧
    - 所以是`Return`
- 当`CR`和`LF`组合使用时
  - 则会将打印纸张上移一行
  - 且下一个打字位置将回到该行的最左侧
  - 也就是我们今天所理解的换行操作

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613961902716)

### 不同操作系统的理解

- 机械打字机渐渐地退出了历史舞台
  - 当初的纸张变成了今天的显示器
  - 打字机的按键也演变为了如今的键盘

#### 操作系统 `Unix` 出现

- 受限于内存和软盘空间的不足
- 设计者决定采用单个字符来表示换行符
  - 使`\n`单字符替代`\r\n`，默认`\n`=`\r\n`
  - C 语言在编程的时候继续了这个惯例
  - 他既干了换行`\n`的活，又干了回车`\r`的活
  - Unix-Like 都是如此，包括 BSD、Linux

### unix 和 c 的演示

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974579679)

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974568636)

- 可是实际上是这样的

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210222-1613974622383)

### Commodore64

- Commondore64 一度很流行
- 同样处于节省空间的目的
- 使用`\r`代替`\r\n`

### MacOS

- 早期也是使用`\r`代替`\r\n`
  - 甚至按键都叫做<kbd>return</kbd>
  - 后来和`unix`保持一致`\n`
- 原因可能是`Mac`用户需要用`ssh`连接`unix-like`的服务器
  - 换行不统一
  - 文件读取错误
- 流行的三大系统两个都是`\n`
- 下面就看微软了

### 微软

- DOS 系统是兼容人家 CP/M 形成的
  - `CP/M`使用`\r\n`
  - 键盘上印的名称是<kbd>enter↵</kbd>
  - 符号能看出就是`\r\n`
  - 其实按照先向下再向左的意思应该是`\n\r`
  - 先 LineFeed 再 Return
- 后来的`windows`顺着`DOS`的惯例
- 这会使跨系统浏览文档的时候
  - 有的时候会所有东西变成一行
  - 有的会出现`'0D'`,` '^M'`之类的乱码
  - 而且`windows`中的文件会变大
- 不只是 windows 记事本的解释方式
  - 而且微软系列的 office 等，都有这个困扰
  - win10 最新的记事本 🗒️，已经针对这个做了优化
  - 其他的微软产品估计也会陆续跟进

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614310857284)

### python 解释器的理解

- python 的显示输出靠的是终端屏幕
- python 的字符输入靠的是终端键盘
- `\n` 显示的时候就会换行 LF
- `\r` 显示的时候就会退回到本行开头 CR
- 录入`\n`的时候就会以`0x0A`这样一个字节的形式存储在内存和硬盘中
- 录入`\r`的时候就会以`0x0D`这样一个字节的形式存储在内存和硬盘中
- 这样的编码来自于 ascii 编码
  - python3 解释器基于操作系统
  - 操作系统基于 cpu 架构
- 不管什么样的操作系统、cpu 架构
- 只要是 python 解释器，对于`\n`、`\r`的理解是统一的
- 是跨平台的(跨系统、跨架构的)。

![图片描述](https://doc.shiyanlou.com/courses/uid1190679-20210226-1614310924673)

## 总结

- 区分概念
  - `terminal`终端，电脑连线结束的端点
  - `shell`，终端硬件基础上的软件壳子
  - `Console` 控制台，直接连接主机的控制面板
  - `TeleTYpewriter`，电传打印机
- 换行和回车是两回事
  - 换行 对应字节`0x0A` Line-Feed 的意思是水平不动、垂直向上喂纸 所以是`feed`
  - 回车 对应字节`0x0D` Carriage-Return 的意思是让上图可移动的打印头(好像可移动的四轮马车 Carriage)垂直不动、水平 `回`到纸张左侧 所以是`Return`
- 对于换行和回车，不同层面的理解
  - 电传打字机:两件事，经常一起干，但也可以分别干
  - 不同操作系统
    - unix-like：大家一起改造这个，就步调一致就都好了
    - windows：原来我用户多，定什么规矩我说了算,现在我还是随大流吧
  - python 解释器
    - 不管在什么系统、什么架构上
    - 我把这个事统一
    - 我觉得`unix-like`做得对
- 光说不练假把式，我能看看电传打字机吗？🤔
- 我们下次再说！👋
